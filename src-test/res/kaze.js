/*
Copyright (c) 2010, Matthew Seeley, All rights reserved
BSD Licensed: http://github.com/mseeley/kaze/blob/master/LICENSE
      Source: git://github.com/mseeley/kaze.git
*/
(function(s){var d=false,a=false,x=false,l=0,o=0,c=[],p=[],v,w;function h(y,z){var A=s.setTimeout(y,z||0);return{clear:function(){s.clearTimeout(A)}}}function b(){return +new Date()}function u(y,A){var B=w.loopId,z=q(A);return function(){var C=arguments;h(function(){z.clear();if(w&&w.loopId==B){e(y.apply(null,C))}})}}function q(y){a=true;return h(e,y||5000)}function e(y){a=false;g(y);f(b());t()}function f(z,y){var A=z-o>50;if(A){o=z;if(y){h(y)}}return A}function r(){var y,z;while(w.loop++<v.loops){z=b();w.start=z;w.loopId=++l;y=w.fn(u);if(!a){g(y);if(f(z,r)){return}}else{return}}t()}function g(y){w.elapsed+=b()-w.start;if(w.pass!==false){w.pass=!!y}}function t(){if(w.loop<v.loops){r()}else{v.onresult(w.name,w.pass,w.elapsed,v.loops,v.tests.length);k()}}function k(){if(x){return}if((w=v.tests.shift())){w.elapsed=w.start=w.loop=0;w.pass=w.loopId=null;r()}else{j()}}function j(){if((v=p.shift())){d=true;k()}else{d=false}}function m(B){B=B||/./;var z=c.length,y=[],C,A=0;for(A;A<z;A++){C=c[A];if(B.test(C.name)){y.push({name:C.name,fn:C.fn})}}return y}function n(y,z){if(y&&z){c.push({name:y,fn:z})}}function i(){f(b(),j)}s.kaze={test:n,clear:function(){c=[];p=[]},run:function(z,A,y){p.push({onresult:z||function(){},loops:y||1,tests:m(A)});if(!d&&!x){i()}},tests:function(){var A=arguments,z=A.length,B=0,C,y;for(B;B<z;B++){y=A[B];for(C in y){if(y.hasOwnProperty(C)){n(C,y[C])}}}},pause:function(){if(!x){x=true}},resume:function(){if(x){x=false;if(d){h(k)}else{i()}}}}})(this);
